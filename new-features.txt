–¢–ò–ü: Supabase/Postgres schema migration + Next.js app changes
–ï–ó–ò–ö: Bulgarian (–∫–æ–º–µ–Ω—Ç–∞—Ä–∏ –≤ –∫–æ–¥–∞ –º–æ–∂–µ –Ω–∞ EN)
–¶–ï–õ: –ï–≤–æ–ª—é—Ü–∏—è –Ω–∞ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞—â–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ ‚Äúsignalilovech.com‚Äù –æ—Ç ‚Äú—Å–∞–º–æ –¥—É–ø–∫–∏‚Äù –∫—ä–º ‚Äú–º—É–ª—Ç–∏-–∫–∞—Ç–µ–≥–æ—Ä–∏–µ–Ω‚Äù civic reporting (–û–±—â–∏–Ω–∞ –õ–æ–≤–µ—á + —Å–µ–ª–∞), –±–µ–∑ –¥–∞ —Å–µ —á—É–ø–∏ —Ç–µ–∫—É—â–æ—Ç–æ.

========================
1) –ö–ê–ö–í–û –ò–ú–ê–ú–ï –í –ú–û–ú–ï–ù–¢–ê
========================

–ò–º–∞–º–µ Supabase Postgres schema:

TABLE reports:
- id uuid PK default gen_random_uuid()
- city text not null default 'Lovech'   -- –¥–æ—Å–µ–≥–∞ —Å–µ –ø–æ–ª–∑–≤–∞ –∑–∞ –≥—Ä–∞–¥ (–º–æ–∂–µ –±–∏ –∏ —Å–µ–ª–∞)
- lat float8 not null
- lng float8 not null
- severity int not null check (1,2,3)   -- —Ç–µ–∂–µ—Å—Ç –∑–∞ –¥—É–ø–∫–∏
- comment text
- email_hash text not null
- verify_token_hash text
- verified boolean not null default false
- created_at timestamptz not null default now()

TABLE report_photos:
- id uuid PK default gen_random_uuid()
- report_id uuid FK -> reports(id) on delete cascade
- storage_path text not null
- created_at timestamptz not null default now()

Storage bucket: pothole-photos
–õ–æ–≥–∏–∫–∞: –Ω–∞ –∫–∞—Ä—Ç–∞—Ç–∞ —Å–µ –ø–æ–∫–∞–∑–≤–∞—Ç —Å–∞–º–æ verified=true.

–ò–º–∞–º–µ –∏ –º–∏–≥—Ä–∞—Ü–∏—è –∑–∞ first_name/last_name (–≤–µ—á–µ –¥–æ–±–∞–≤–µ–Ω–∏ –∫–∞—Ç–æ –∫–æ–ª–æ–Ω–∏, –∞–∫–æ –≥–∏ –Ω—è–º–∞):
- alter table reports add column if not exists first_name text;
- alter table reports add column if not exists last_name text;

========================
2) –ö–ê–ö–í–û –ò–°–ö–ê–ú–ï –î–ê –î–û–ë–ê–í–ò–ú
========================

–ò—Å–∫–∞–º–µ –¥–∞ –ø–æ–¥–¥—ä—Ä–∂–∞–º–µ —Å–ª–µ–¥–Ω–∏—Ç–µ —Ç–∏–ø–æ–≤–µ —Å–∏–≥–Ω–∞–ª–∏ (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏):

1) pothole (–ø—ä—Ç–Ω–∏ –Ω–µ—Ä–∞–≤–Ω–æ—Å—Ç–∏/–¥—É–ø–∫–∏) - –≤–µ—á–µ –≥–æ –∏–º–∞–º–µ –∫–∞—Ç–æ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è
2) fallen_tree (–ø–∞–¥–Ω–∞–ª–∏ –∫–ª–æ–Ω–∏/–¥—ä—Ä–≤–µ—Ç–∞) - –Ω–æ–≤–æ
3) road_marking (–∏–∑—Ç—Ä–∏—Ç–∞ –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ / –ø–µ—à–µ—Ö–æ–¥–Ω–∞ –ø—ä—Ç–µ–∫–∞) - –Ω–æ–≤–æ
4) street_light (–Ω–µ—Å–≤–µ—Ç–µ—â–∞ / –ø–æ–≤—Ä–µ–¥–µ–Ω–∞ –ª–∞–º–ø–∞) - –Ω–æ–≤–æ
5) traffic_sign (–ø–∞–¥–Ω–∞–ª / –ª–∏–ø—Å–≤–∞—â –∑–Ω–∞–∫) - –Ω–æ–≤–æ
6) hazard (–æ–ø–∞—Å–µ–Ω —É—á–∞—Å—Ç—ä–∫ / —Å—Ä—É—Ç–≤–∞–Ω–µ) - –Ω–æ–≤–æ

–ò—Å–∫–∞–º–µ –∏ —Ä–∞–∑—à–∏—Ä—è–≤–∞–Ω–µ –æ—Ç ‚Äú–ì—Ä–∞–¥ –õ–æ–≤–µ—á‚Äù –∫—ä–º ‚Äú–û–±—â–∏–Ω–∞ –õ–æ–≤–µ—á‚Äù:
- –¥–∞ –∏–º–∞ municipality (–Ω–∞–ø—Ä. 'Lovech')
- –¥–∞ –∏–º–∞ settlement (–Ω–∞–ø—Ä. 'Lovech', 'Bahovitsa', 'Aleksandrovo' –∏ —Ç.–Ω.)
–¢–∞–∫–∞ –º–æ–∂–µ–º –¥–∞ —Ñ–∏–ª—Ç—Ä–∏—Ä–∞–º–µ –∫–∞—Ä—Ç–∞ –ø–æ –Ω–∞—Å–µ–ª–µ–Ω–æ –º—è—Å—Ç–æ.

–ò—Å–∫–∞–º–µ –¥–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–æ ‚Äústatus‚Äù –Ω–∞ —Å–∏–≥–Ω–∞–ª–∞ –∑–∞ UX –∏ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç:
- new
- in_progress
- resolved
+ optional resolved_at timestamp

–í–ê–ñ–ù–û: –∏—Å–∫–∞–º–µ backwards compatibility:
- —Å—Ç–∞—Ä–∏—è—Ç –∫–æ–¥ –º–æ–∂–µ –æ—â–µ –¥–∞ –ø–æ–ª–∑–≤–∞ reports.city, severity –∏ —Ç.–Ω.
- –Ω–æ–≤–∏—è—Ç –∫–æ–¥ —â–µ –ø–æ–ª–∑–≤–∞ category + municipality/settlement + status
- —Ç–µ–∫—É—â–∏—Ç–µ –¥–∞–Ω–Ω–∏ —Ç—Ä—è–±–≤–∞ –¥–∞ –æ—Å—Ç–∞–Ω–∞—Ç –≤–∞–ª–∏–¥–Ω–∏

========================
3) –ü–û–î–•–û–î (–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
========================

–ò–∑–±–∏—Ä–∞–º–µ –ø–æ–¥—Ö–æ–¥ —Å ENUM —Ç–∏–ø–æ–≤–µ –≤ Postgres –∑–∞:
- report_category enum: ('pothole','fallen_tree','road_marking','street_light','traffic_sign','hazard')
- report_status enum: ('new','in_progress','resolved')

–ü—Ä–∏—á–∏–Ω–∞: data integrity (–±–µ–∑ –≥—Ä–µ—à–Ω–∏ —Ç–µ–∫—Å—Ç–æ–≤–µ), –ø–æ-–ª–µ—Å–Ω–∏ —Ñ–∏–ª—Ç—Ä–∏, –ø–æ-—á–∏—Å—Ç –∫–æ–¥.

–ù–µ –ø—Ä–∞–≤–∏–º –æ—Ç–¥–µ–ª–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ categories –Ω–∞ —Ç–æ–∑–∏ –µ—Ç–∞–ø, –∑–∞—â–æ—Ç–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏—Ç–µ —Å–∞ —Ñ–∏–∫—Å–∏—Ä–∞–Ω–∏.

–î–æ–±–∞–≤—è–º–µ –Ω–æ–≤–∏ –∫–æ–ª–æ–Ω–∏ –≤ reports (–±–µ–∑ –¥–∞ —Ç—Ä–∏–µ–º —Å—Ç–∞—Ä–∏—Ç–µ –≤–µ–¥–Ω–∞–≥–∞):
- municipality text NOT NULL DEFAULT 'Lovech'
- settlement text NOT NULL DEFAULT 'Lovech'
- category report_category NOT NULL DEFAULT 'pothole'
- status report_status NOT NULL DEFAULT 'new'
- updated_at timestamptz NOT NULL DEFAULT now()
- resolved_at timestamptz NULL

–ü–æ –∏–∑–±–æ—Ä (–∞–∫–æ –µ –ø–æ–ª–µ–∑–Ω–æ –∑–∞ –±—ä–¥–µ—â–∏ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∏ –¥–∞–Ω–Ω–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏):
- metadata jsonb NOT NULL DEFAULT '{}'::jsonb

–î–æ–±–∞–≤—è–º–µ –∏–Ω–¥–µ–∫—Å–∏ –∑–∞ performance:
- verified, category, (municipality, settlement), created_at desc, (lat,lng)

–î–æ–±–∞–≤—è–º–µ trigger –∑–∞ updated_at –ø—Ä–∏ UPDATE.

========================
4) –ö–ê–ö–í–û –¢–†–Ø–ë–í–ê –î–ê –ì–ï–ù–ï–†–ò–†–ê–® (DELIVERABLES)
========================

A) SQL Migration —Å–∫—Ä–∏–ø—Ç (idempotent):
1. –°—ä–∑–¥–∞–π enum —Ç–∏–ø–æ–≤–µ—Ç–µ report_category –∏ report_status (do $$ begin ... exception duplicate_object ... end $$).
2. Alter table reports add column if not exists ... –∑–∞ –≤—Å–∏—á–∫–∏ –Ω–æ–≤–∏ –∫–æ–ª–æ–Ω–∏.
3. (Optional) –ê–∫–æ city –¥–æ—Å–µ–≥–∞ —Å—ä–¥—ä—Ä–∂–∞ —Ä–µ–∞–ª–Ω–æ –Ω–∞—Å–µ–ª–µ–Ω–æ –º—è—Å—Ç–æ, –º–∏–≥—Ä–∏—Ä–∞–π –¥–∞–Ω–Ω–∏—Ç–µ:
   - settlement = city –∑–∞ —Ä–µ–¥–æ–≤–µ—Ç–µ, –ø—Ä–∏ –∫–æ–∏—Ç–æ settlement –µ default –∏ city != 'Lovech'
   –ù–æ –Ω–µ –ø—Ä–∞–≤–∏ destructive migration. –°–∞–º–æ –±–µ–∑–æ–ø–∞—Å–µ–Ω update.
4. Create indexes if not exists.
5. Create trigger function set_updated_at() + trigger before update.

B) –ü—Ä–æ–º–µ–Ω–∏ –ø–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ (Next.js / API routes):
1. Update –Ω–∞ form –∑–∞ –Ω–æ–≤ —Å–∏–≥–Ω–∞–ª:
   - –¥–æ–±–∞–≤–∏ dropdown/select –∑–∞ category (6 —Ç–∏–ø–∞) + label –Ω–∞ BG
   - –¥–æ–±–∞–≤–∏ settlement select (–∏–ª–∏ input) –∑–∞ —Å–µ–ª–æ/–≥—Ä–∞–¥
   - municipality –ø–æ default 'Lovech'
   - severity –æ—Å—Ç–∞–≤–∞ 1..3 (–æ–±—â–∞ —Ç–µ–∂–µ—Å—Ç) –∑–∞ –≤—Å–∏—á–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
   - comment + photos –æ—Å—Ç–∞–≤–∞—Ç
2. Update –Ω–∞ map query:
   - –¥–∞ —Ñ–∏–ª—Ç—Ä–∏—Ä–∞ verified=true
   - –¥–∞ –ø–æ–∑–≤–æ–ª—è–≤–∞ —Ñ–∏–ª—Ç—ä—Ä –ø–æ category
   - –¥–∞ –ø–æ–∑–≤–æ–ª—è–≤–∞ —Ñ–∏–ª—Ç—ä—Ä –ø–æ settlement (–∏/–∏–ª–∏ municipality)
3. UI marker icons:
   - pothole -> üï≥Ô∏è
   - fallen_tree -> üå≥
   - road_marking -> ü¶ì –∏–ª–∏ üõ£Ô∏è
   - street_light -> üí°
   - traffic_sign -> üö´
   - hazard -> ‚ö†Ô∏è
   (–∞–∫–æ –∏–º–∞–º–µ custom markers ‚Äì –æ–ø–∏—à–∏ –∫–∞–∫ –¥–∞ —Å–µ –º–∞–ø–≤–∞—Ç)
4. Backwards compatibility:
   - –∞–∫–æ –Ω—è–∫—ä–¥–µ —Å–µ –ø–æ–ª–∑–≤–∞ city, –Ω–µ –≥–æ –ø—Ä–µ–º–∞—Ö–≤–∞–π –≤ –∫–æ–¥–∞ –∑–∞—Å–µ–≥–∞
   - –Ω–æ–≤–∏—Ç–µ insert-–∏ –¥–∞ –∑–∞–ø–∏—Å–≤–∞—Ç –∏ city (–º–æ–∂–µ city=settlement –∏–ª–∏ city='Lovech') –¥–æ–∫–∞—Ç–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä—ä—Ç –ø—Ä–∏–∫–ª—é—á–∏

C) –ò–∑—Ö–æ–¥–µ–Ω —Ñ–æ—Ä–º–∞—Ç:
- –ü—ä—Ä–≤–æ –¥–∞–π SQL migration –∫–∞—Ç–æ –µ–¥–∏–Ω –±–ª–æ–∫ (–≥–æ—Ç–æ–≤ –∑–∞ Supabase SQL Editor).
- –ü–æ—Å–ª–µ –¥–∞–π —Å–ø–∏—Å—ä–∫ —Å —Ñ–∞–π–ª–æ–≤–µ/–ø—Ä–æ–º–µ–Ω–∏ –ø–æ –ø—Ä–æ–µ–∫—Ç–∞ (–ø—Ä–∏–º–µ—Ä–Ω–æ /app/api/reports/route.ts, components/ReportForm.tsx, components/Map.tsx).
- –î–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏ code snippets –∑–∞ insert/select –∫—ä–º Supabase.
- –ù–µ –∏–∑–º–∏—Å–ª—è–π –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏; –∞–∫–æ —Å–µ –Ω–∞–ª–æ–∂–∏, –∏–∑–ø–æ–ª–∑–≤–∞–π —Å—ä—â–∏—è stack (Supabase JS client, Next.js route handlers).
- –ù–µ –ø—Ä–æ–º–µ–Ω—è–π RLS –≤ —Ç–æ–∑–∏ –µ—Ç–∞–ø (—Å–∞–º–æ –∞–∫–æ –µ –∞–±—Å–æ–ª—é—Ç–Ω–æ –Ω—É–∂–Ω–æ; –∏–Ω–∞—á–µ –æ—Å—Ç–∞–≤–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä –∫–∞–∫–≤–æ –±–∏ –Ω–∞–ø—Ä–∞–≤–∏–ª –ø–æ-–∫—ä—Å–Ω–æ).

========================
5) –ö–†–ò–¢–ï–†–ò–ò –ó–ê –£–°–ü–ï–•
========================
- –°–ª–µ–¥ –º–∏–≥—Ä–∞—Ü–∏—è—Ç–∞: —Å—Ç–∞—Ä–∏—Ç–µ –¥–∞–Ω–Ω–∏ —Ä–∞–±–æ—Ç—è—Ç –∏ —Å–µ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–∞—Ç.
- –ù–æ–≤–∏ —Å–∏–≥–Ω–∞–ª–∏ –º–æ–≥–∞—Ç –¥–∞ —Å–µ –¥–æ–±–∞–≤—è—Ç –≤—ä–≤ –≤—Å–∏—á–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.
- –§–∏–ª—Ç—Ä–∏—Ç–µ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –∏ –Ω–∞—Å–µ–ª–µ–Ω–æ –º—è—Å—Ç–æ —Ä–∞–±–æ—Ç—è—Ç.
- –ù—è–º–∞ breaking changes –≤ –±–∞–∑–∞—Ç–∞.
- SQL –µ –±–µ–∑–æ–ø–∞—Å–µ–Ω –∑–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ (IF NOT EXISTS / duplicate_object handling).